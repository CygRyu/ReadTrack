<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReadTrack - Your Reading Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6D28D9;
            --primary-light: #8B5CF6;
            --secondary: #F97316;
            --background-light: #F8FAFC;
            --background-dark: #1E293B;
            --text-light: #334155;
            --text-dark: #E2E8F0;
            --card-light: #FFFFFF;
            --card-dark: #334155;
        }
        
        .dark {
            --primary: #8B5CF6;
            --primary-light: #A78BFA;
            --secondary: #FB923C;
        }
        
        body {
            font-family: 'Quicksand', sans-serif;
        }
        
        @media (prefers-color-scheme: dark) {
            body:not(.light-mode) {
                background-color: var(--background-dark);
                color: var(--text-dark);
            }
            
            body:not(.light-mode) .card {
                background-color: var(--card-dark);
            }
        }
        
        @media (prefers-color-scheme: light) {
            body:not(.dark-mode) {
                background-color: var(--background-light);
                color: var(--text-light);
            }
            
            body:not(.dark-mode) .card {
                background-color: var(--card-light);
            }
        }
        
        .card {
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn {
            transition: all 0.2s;
        }
        
        .btn:active {
            transform: scale(0.97);
        }
        
        .tab-active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .7;
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <header class="bg-gradient-to-r from-purple-600 to-purple-700 text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                </svg>
                ReadTrack
            </h1>
            <div>
                <button id="backup-btn" class="bg-purple-800 hover:bg-purple-900 text-white px-3 py-1 rounded-lg text-sm">
                    Backup Data
                </button>
            </div>
        </div>
    </header>

    <div class="container mx-auto p-4 flex-grow">
        <div class="w-full overflow-hidden mb-5">
            <nav class="flex border-b border-gray-300 dark:border-gray-600 mb-4">
                <button class="tab-btn tab-active px-4 py-2 font-medium" data-tab="dashboard">Dashboard</button>
                <button class="tab-btn px-4 py-2 font-medium" data-tab="log-reading">Log Reading</button>
                <button class="tab-btn px-4 py-2 font-medium" data-tab="my-books">My Books</button>
                <button class="tab-btn px-4 py-2 font-medium" data-tab="insights">Insights</button>
                <button class="tab-btn px-4 py-2 font-medium" data-tab="settings">Settings</button>
            </nav>
            
            <!-- Dashboard Tab -->
            <div class="tab-content" id="dashboard">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="card p-4 bg-white dark:bg-gray-700">
                        <h3 class="text-lg font-bold mb-2 text-gray-700 dark:text-gray-200">Total Pages Read</h3>
                        <p class="text-3xl font-bold text-purple-600 dark:text-purple-400" id="total-pages">0</p>
                    </div>
                    <div class="card p-4 bg-white dark:bg-gray-700">
                        <h3 class="text-lg font-bold mb-2 text-gray-700 dark:text-gray-200">Books Completed</h3>
                        <p class="text-3xl font-bold text-purple-600 dark:text-purple-400" id="books-completed">0</p>
                    </div>
                    <div class="card p-4 bg-white dark:bg-gray-700">
                        <h3 class="text-lg font-bold mb-2 text-gray-700 dark:text-gray-200">Reading Streak</h3>
                        <p class="text-3xl font-bold text-purple-600 dark:text-purple-400" id="reading-streak">0 days</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="card p-4 bg-white dark:bg-gray-700">
                        <h3 class="text-lg font-bold mb-4 text-gray-700 dark:text-gray-200">Reading Activity</h3>
                        <div class="h-64">
                            <canvas id="reading-chart"></canvas>
                        </div>
                    </div>
                    <div class="card p-4 bg-white dark:bg-gray-700">
                        <h3 class="text-lg font-bold mb-2 text-gray-700 dark:text-gray-200">Reading Stats</h3>
                        <ul class="space-y-2">
                            <li class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-300">Avg. Pages per Day:</span>
                                <span class="font-medium text-gray-800 dark:text-gray-100" id="avg-pages">0</span>
                            </li>
                            <li class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-300">Most Pages in a Day:</span>
                                <span class="font-medium text-gray-800 dark:text-gray-100" id="most-pages">0</span>
                            </li>
                            <li class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-300">Current Books:</span>
                                <span class="font-medium text-gray-800 dark:text-gray-100" id="current-books">0</span>
                            </li>
                            <li class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-300">Days Read This Month:</span>
                                <span class="font-medium text-gray-800 dark:text-gray-100" id="days-read">0</span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <div class="card p-4 bg-white dark:bg-gray-700 mb-6">
                    <h3 class="text-lg font-bold mb-4 text-gray-700 dark:text-gray-200">Currently Reading</h3>
                    <div id="current-reading-list" class="space-y-4">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-4" id="no-books-message">You haven't added any books yet.</p>
                    </div>
                </div>
                
                <div class="card p-4 bg-white dark:bg-gray-700">
                    <h3 class="text-lg font-bold mb-4 text-gray-700 dark:text-gray-200">Recent Reading Log</h3>
                    <div id="recent-logs" class="space-y-3">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-4" id="no-logs-message">No reading logs yet. Start logging your reading!</p>
                    </div>
                </div>
            </div>
            
            <!-- Log Reading Tab -->
            <div class="tab-content hidden" id="log-reading">
                <div class="card p-6 bg-white dark:bg-gray-700 mb-6">
                    <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-100">Log Your Reading</h2>
                    
                    <form id="reading-log-form" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-600 dark:text-gray-300 mb-2" for="log-book">Book</label>
                                <select id="log-book" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 text-base" required>
                                    <option value="">Select a book</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-600 dark:text-gray-300 mb-2" for="log-date">Date</label>
                                <input type="date" id="log-date" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 text-base" required>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-gray-600 dark:text-gray-300 mb-2" for="log-pages">Pages Read</label>
                            <input type="number" id="log-pages" min="1" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 text-base" placeholder="How many pages did you read?" required>
                        </div>
                        
                        <div>
                            <label class="block text-gray-600 dark:text-gray-300 mb-2" for="log-notes">Notes (optional)</label>
                            <textarea id="log-notes" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 text-base" rows="3" placeholder="Any thoughts or reflections about your reading?"></textarea>
                        </div>
                        
                        <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg transition">Log Reading</button>
                    </form>
                </div>
                
                <div class="card p-6 bg-white dark:bg-gray-700">
                    <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-100">Reading History</h2>
                    <div id="reading-logs-container" class="space-y-4">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-4" id="no-history-message">No reading logs yet. Start logging your reading!</p>
                    </div>
                </div>
            </div>
            
            <!-- My Books Tab -->
            <div class="tab-content hidden" id="my-books">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800 dark:text-gray-100">My Books Collection</h2>
                    <button id="add-book-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg transition flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                        Add Book
                    </button>
                </div>
                
                <div id="books-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <p class="text-gray-500 dark:text-gray-400 text-center py-4 col-span-full" id="empty-books-message">You haven't added any books yet. Click "Add Book" to get started.</p>
                </div>
                
                <!-- Add/Edit Book Modal -->
                <div id="book-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4">
                        <h3 id="modal-title" class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-100">Add New Book</h3>
                        
                        <form id="book-form" class="space-y-4">
                            <input type="hidden" id="book-id">
                            
                            <div>
                                <label class="block text-gray-600 dark:text-gray-300 mb-2" for="book-title">Title</label>
                                <input type="text" id="book-title" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-base" placeholder="Book title" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-600 dark:text-gray-300 mb-2" for="book-author">Author</label>
                                <input type="text" id="book-author" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-base" placeholder="Author name" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-600 dark:text-gray-300 mb-2" for="book-genre">Genre</label>
                                <input type="text" id="book-genre" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-base" placeholder="Book genre">
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-600 dark:text-gray-300 mb-2" for="book-total-pages">Total Pages</label>
                                    <input type="number" id="book-total-pages" min="1" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-base" placeholder="Total pages" required>
                                </div>
                                <div>
                                    <label class="block text-gray-600 dark:text-gray-300 mb-2" for="book-current-page">Current Page</label>
                                    <input type="number" id="book-current-page" min="0" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-base" placeholder="Current page" required>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-2 pt-2">
                                <button type="button" id="cancel-book" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium py-2 px-4 rounded-lg transition">Cancel</button>
                                <button type="submit" id="save-book" class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg transition">Save Book</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Insights Tab -->
            <div class="tab-content hidden" id="insights">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="card p-4 bg-white dark:bg-gray-700">
                        <h3 class="text-lg font-bold mb-4 text-gray-700 dark:text-gray-200">Favorite Genres</h3>
                        <div class="h-64">
                            <canvas id="genres-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card p-4 bg-white dark:bg-gray-700">
                        <h3 class="text-lg font-bold mb-4 text-gray-700 dark:text-gray-200">Reading Projections</h3>
                        <div id="reading-projections" class="space-y-3">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-4" id="no-projections-message">
                                Add books and log your reading to see projections!
                            </p>
                        </div>
                    </div>
                    
                    <div class="card p-4 bg-white dark:bg-gray-700 col-span-1 md:col-span-2">
                        <h3 class="text-lg font-bold mb-4 text-gray-700 dark:text-gray-200">Reading Habits</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="h-64">
                                <canvas id="weekly-chart"></canvas>
                            </div>
                            <div class="h-64">
                                <canvas id="monthly-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div class="tab-content hidden" id="settings">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="card p-6 bg-white dark:bg-gray-700">
                        <h3 class="text-lg font-bold mb-4 text-gray-700 dark:text-gray-200">Data Backup</h3>
                        <p class="text-gray-600 dark:text-gray-300 mb-4">Export your reading data for safekeeping or import previously exported data.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <button id="export-data" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg transition flex justify-center items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                    </svg>
                                    Export Data
                                </button>
                            </div>
                            
                            <div>
                                <label class="block text-gray-600 dark:text-gray-300 mb-2" for="import-data-input">Import Data</label>
                                <textarea id="import-data-input" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 text-base" rows="4" placeholder="Paste your exported data here"></textarea>
                            </div>
                            
                            <button id="import-data" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg transition flex justify-center items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                </svg>
                                Import Data
                            </button>
                        </div>
                    </div>
                    
                    <div class="card p-6 bg-white dark:bg-gray-700">
                        <h3 class="text-lg font-bold mb-4 text-gray-700 dark:text-gray-200">About ReadTrack</h3>
                        <p class="text-gray-600 dark:text-gray-300 mb-4">ReadTrack helps you track your reading progress, manage your book collection, and visualize your reading statistics.</p>
                        
                        <div class="mb-4">
                            <span class="block text-gray-600 dark:text-gray-300 mb-1">Version:</span>
                            <span class="font-medium text-gray-800 dark:text-gray-100">1.0.0</span>
                        </div>
                        
                        <h4 class="font-bold text-gray-700 dark:text-gray-200 mb-2">Support the Developer</h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-4">If you enjoy using this app, please consider supporting its development!</p>
                        
                        <div class="space-y-2">
                            <a href="https://ko-fi.com/cygryu" target="_blank" class="block w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition text-center">
                                Ko-Fi
                            </a>
                            <a href="https://paypal.me/sofiansu?country.x=ID&locale.x=en_US" target="_blank" class="block w-full bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded-lg transition text-center">
                                PayPal
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-white p-4 mt-auto">
        <div class="container mx-auto text-center">
            <p>Developed by CygRyu</p>
            <p class="text-sm text-gray-400">Â© 2023 ReadTrack. All rights reserved.</p>
        </div>
    </footer>

    <!-- Notification Toast -->
    <div id="notification" class="fixed bottom-4 right-4 bg-gray-800 text-white px-4 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-y-20 opacity-0 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
        </svg>
        <span id="notification-text"></span>
    </div>

    <script>
        // App Constants
        const APP_VERSION = '1.0.0';
        
        // Initialize data structure
        let appData = {
            version: APP_VERSION,
            books: [],
            readingLogs: [],
            lastBackup: null
        };
        
        // DOM Elements
        const elements = {
            tabs: document.querySelectorAll('.tab-btn'),
            tabContents: document.querySelectorAll('.tab-content'),
            bookModal: document.getElementById('book-modal'),
            addBookBtn: document.getElementById('add-book-btn'),
            cancelBookBtn: document.getElementById('cancel-book'),
            bookForm: document.getElementById('book-form'),
            booksContainer: document.getElementById('books-container'),
            readingLogForm: document.getElementById('reading-log-form'),
            logBookSelect: document.getElementById('log-book'),
            readingLogsContainer: document.getElementById('reading-logs-container'),
            recentLogsContainer: document.getElementById('recent-logs'),
            currentReadingList: document.getElementById('current-reading-list'),
            exportDataBtn: document.getElementById('export-data'),
            importDataBtn: document.getElementById('import-data'),
            importDataInput: document.getElementById('import-data-input'),
            backupBtn: document.getElementById('backup-btn'),
            notification: document.getElementById('notification'),
            // Charts
            readingChart: document.getElementById('reading-chart'),
            genresChart: document.getElementById('genres-chart'),
            weeklyChart: document.getElementById('weekly-chart'),
            monthlyChart: document.getElementById('monthly-chart'),
            // Stats
            totalPagesElement: document.getElementById('total-pages'),
            booksCompletedElement: document.getElementById('books-completed'),
            readingStreakElement: document.getElementById('reading-streak'),
            avgPagesElement: document.getElementById('avg-pages'),
            mostPagesElement: document.getElementById('most-pages'),
            currentBooksElement: document.getElementById('current-books'),
            daysReadElement: document.getElementById('days-read'),
            readingProjections: document.getElementById('reading-projections'),
            // Messages
            noProjectionsMessage: document.getElementById('no-projections-message'),
            emptyBooksMessage: document.getElementById('empty-books-message'),
            noLogsMessage: document.getElementById('no-logs-message'),
            noHistoryMessage: document.getElementById('no-history-message'),
            noBooksMessage: document.getElementById('no-books-message')
        };
        
        // Charts
        let charts = {
            readingActivity: null,
            genres: null,
            weekly: null,
            monthly: null
        };
        
        // Initialize the app
        function initApp() {
            // Set today's date as default for log form
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('log-date').value = today;
            
            // Load data from localStorage
            loadData();
            
            // Setup event listeners
            setupEventListeners();
            
            // Render initial UI
            renderBooks();
            renderReadingLogs();
            renderCurrentlyReading();
            updateStats();
            renderInsights();
            
            // Initialize charts
            initCharts();
        }
        
        // Data Management Functions
        function loadData() {
            const savedData = localStorage.getItem('readTrackData');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    
                    // Version compatibility check
                    if (parsedData.version !== APP_VERSION) {
                        // Handle version migration if needed
                        migrateData(parsedData);
                    } else {
                        appData = parsedData;
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    showNotification('Error loading saved data. Starting fresh.');
                }
            }
        }
        
        function saveData() {
            try {
                localStorage.setItem('readTrackData', JSON.stringify(appData));
            } catch (error) {
                console.error('Error saving data:', error);
                showNotification('Error saving data. Please export your data as backup.');
            }
        }
        
        function migrateData(oldData) {
            // Simple migration - just keep the old data but update version
            // In a real app, you would transform data structures as needed
            appData = {
                ...oldData,
                version: APP_VERSION
            };
            
            // Save the migrated data
            saveData();
            
            showNotification(`Data migrated from version ${oldData.version} to ${APP_VERSION}`);
        }
        
        function exportData() {
            try {
                const dataString = JSON.stringify(appData);
                const encodedData = btoa(dataString);
                elements.importDataInput.value = encodedData;
                showNotification('Data exported. Copy the text in the import field.');
            } catch (error) {
                console.error('Error exporting data:', error);
                showNotification('Error exporting data. Please try again.');
            }
        }
        
        function importData() {
            try {
                const encodedData = elements.importDataInput.value.trim();
                if (!encodedData) {
                    showNotification('Please paste exported data first.');
                    return;
                }
                
                const dataString = atob(encodedData);
                const importedData = JSON.parse(dataString);
                
                // Version compatibility check
                if (importedData.version !== APP_VERSION) {
                    // Handle version migration if needed
                    migrateData(importedData);
                } else {
                    appData = importedData;
                    saveData();
                }
                
                // Re-render the UI
                renderBooks();
                renderReadingLogs();
                renderCurrentlyReading();
                updateStats();
                renderInsights();
                updateCharts();
                
                showNotification('Data imported successfully!');
            } catch (error) {
                console.error('Error importing data:', error);
                showNotification('Invalid data format. Please check your input.');
            }
        }
        
        // Book Management Functions
        function addBook(bookData) {
            const bookId = Date.now().toString();
            const newBook = {
                id: bookId,
                title: bookData.title,
                author: bookData.author,
                genre: bookData.genre || 'Uncategorized',
                totalPages: parseInt(bookData.totalPages),
                currentPage: parseInt(bookData.currentPage),
                completed: parseInt(bookData.currentPage) >= parseInt(bookData.totalPages),
                addedDate: new Date().toISOString()
            };
            
            appData.books.push(newBook);
            saveData();
            
            return newBook;
        }
        
        function updateBook(bookId, bookData) {
            const bookIndex = appData.books.findIndex(book => book.id === bookId);
            if (bookIndex !== -1) {
                const updatedBook = {
                    ...appData.books[bookIndex],
                    title: bookData.title,
                    author: bookData.author,
                    genre: bookData.genre || 'Uncategorized',
                    totalPages: parseInt(bookData.totalPages),
                    currentPage: parseInt(bookData.currentPage),
                    completed: parseInt(bookData.currentPage) >= parseInt(bookData.totalPages)
                };
                
                appData.books[bookIndex] = updatedBook;
                saveData();
                
                return updatedBook;
            }
            return null;
        }
        
        function deleteBook(bookId) {
            const bookIndex = appData.books.findIndex(book => book.id === bookId);
            if (bookIndex !== -1) {
                // Remove the book
                appData.books.splice(bookIndex, 1);
                
                // Remove associated reading logs
                appData.readingLogs = appData.readingLogs.filter(log => log.bookId !== bookId);
                
                saveData();
                return true;
            }
            return false;
        }
        
        function renderBooks() {
            // Update book dropdown in reading log form
            elements.logBookSelect.innerHTML = '<option value="">Select a book</option>';
            
            // Render books in books container
            if (appData.books.length === 0) {
                elements.booksContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4 col-span-full" id="empty-books-message">You haven\'t added any books yet. Click "Add Book" to get started.</p>';
                elements.emptyBooksMessage = document.getElementById('empty-books-message');
                return;
            }
            
            elements.emptyBooksMessage.classList.add('hidden');
            
            let booksHTML = '';
            appData.books.forEach(book => {
                const progress = Math.round((book.currentPage / book.totalPages) * 100);
                const progressColor = progress < 30 ? 'bg-red-500' : progress < 70 ? 'bg-yellow-500' : 'bg-green-500';
                
                booksHTML += `
                <div class="card bg-white dark:bg-gray-700 p-4 flex flex-col" data-book-id="${book.id}">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100">${book.title}</h3>
                        <div class="flex space-x-1">
                            <button class="edit-book-btn text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                </svg>
                            </button>
                            <button class="delete-book-btn text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <p class="text-gray-600 dark:text-gray-300 mb-1">by ${book.author}</p>
                    <p class="text-gray-500 dark:text-gray-400 text-sm mb-2">${book.genre}</p>
                    
                    <div class="mt-auto">
                        <div class="flex justify-between text-sm text-gray-600 dark:text-gray-300 mb-1">
                            <span>Progress: ${progress}%</span>
                            <span>${book.currentPage} / ${book.totalPages} pages</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5">
                            <div class="${progressColor} h-2.5 rounded-full" style="width: ${progress}%"></div>
                        </div>
                    </div>
                </div>
                `;
                
                // Add to reading log dropdown
                if (!book.completed) {
                    elements.logBookSelect.innerHTML += `<option value="${book.id}">${book.title}</option>`;
                }
            });
            
            elements.booksContainer.innerHTML = booksHTML;
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.edit-book-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const bookCard = e.target.closest('[data-book-id]');
                    const bookId = bookCard.dataset.bookId;
                    openBookModal(bookId);
                });
            });
            
            document.querySelectorAll('.delete-book-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const bookCard = e.target.closest('[data-book-id]');
                    const bookId = bookCard.dataset.bookId;
                    
                    if (confirm('Are you sure you want to delete this book? All reading logs for this book will also be deleted.')) {
                        deleteBook(bookId);
                        renderBooks();
                        renderReadingLogs();
                        renderCurrentlyReading();
                        updateStats();
                        renderInsights();
                        updateCharts();
                    }
                });
            });
        }
        
        function openBookModal(bookId = null) {
            const modalTitle = document.getElementById('modal-title');
            const bookIdField = document.getElementById('book-id');
            const bookTitleField = document.getElementById('book-title');
            const bookAuthorField = document.getElementById('book-author');
            const bookGenreField = document.getElementById('book-genre');
            const bookTotalPagesField = document.getElementById('book-total-pages');
            const bookCurrentPageField = document.getElementById('book-current-page');
            
            if (bookId) {
                // Edit existing book
                modalTitle.textContent = 'Edit Book';
                const book = appData.books.find(b => b.id === bookId);
                if (book) {
                    bookIdField.value = book.id;
                    bookTitleField.value = book.title;
                    bookAuthorField.value = book.author;
                    bookGenreField.value = book.genre;
                    bookTotalPagesField.value = book.totalPages;
                    bookCurrentPageField.value = book.currentPage;
                }
            } else {
                // Add new book
                modalTitle.textContent = 'Add New Book';
                bookIdField.value = '';
                bookTitleField.value = '';
                bookAuthorField.value = '';
                bookGenreField.value = '';
                bookTotalPagesField.value = '';
                bookCurrentPageField.value = '0';
            }
            
            elements.bookModal.classList.remove('hidden');
        }
        
        function closeBookModal() {
            elements.bookModal.classList.add('hidden');
        }
        
        // Reading Log Functions
        function addReadingLog(logData) {
            const logId = Date.now().toString();
            const book = appData.books.find(b => b.id === logData.bookId);
            
            if (!book) {
                return null;
            }
            
            const pagesRead = parseInt(logData.pagesRead);
            
            // Update book's current page
            book.currentPage = Math.min(book.currentPage + pagesRead, book.totalPages);
            book.completed = book.currentPage >= book.totalPages;
            
            // Create the reading log entry
            const newLog = {
                id: logId,
                bookId: logData.bookId,
                bookTitle: book.title,
                date: logData.date,
                pagesRead: pagesRead,
                notes: logData.notes || '',
                timestamp: new Date().toISOString()
            };
            
            appData.readingLogs.push(newLog);
            saveData();
            
            return {
                log: newLog,
                book: book
            };
        }
        
        function deleteReadingLog(logId) {
            const logIndex = appData.readingLogs.findIndex(log => log.id === logId);
            
            if (logIndex !== -1) {
                const log = appData.readingLogs[logIndex];
                const pagesRead = log.pagesRead;
                
                // Remove the log
                appData.readingLogs.splice(logIndex, 1);
                
                // Update book progress
                const book = appData.books.find(b => b.id === log.bookId);
                if (book) {
                    book.currentPage = Math.max(0, book.currentPage - pagesRead);
                    book.completed = book.currentPage >= book.totalPages;
                }
                
                saveData();
                return true;
            }
            
            return false;
        }
        
        function renderReadingLogs() {
            // Sort logs by date (most recent first)
            const sortedLogs = [...appData.readingLogs].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Render logs in reading logs container
            if (sortedLogs.length === 0) {
                elements.readingLogsContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4" id="no-history-message">No reading logs yet. Start logging your reading!</p>';
                elements.noHistoryMessage = document.getElementById('no-history-message');
                
                elements.recentLogsContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4" id="no-logs-message">No reading logs yet. Start logging your reading!</p>';
                elements.noLogsMessage = document.getElementById('no-logs-message');
                return;
            }
            
            // Hide no logs messages
            if (elements.noHistoryMessage) elements.noHistoryMessage.classList.add('hidden');
            if (elements.noLogsMessage) elements.noLogsMessage.classList.add('hidden');
            
            // Render all logs in the reading logs tab
            let logsHTML = '';
            sortedLogs.forEach(log => {
                const formattedDate = new Date(log.date).toLocaleDateString();
                
                logsHTML += `
                <div class="card bg-white dark:bg-gray-700 p-4" data-log-id="${log.id}">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-bold text-gray-800 dark:text-gray-100">${log.bookTitle}</h4>
                            <p class="text-gray-600 dark:text-gray-300">${formattedDate}</p>
                            <p class="text-purple-600 dark:text-purple-400 font-medium mt-1">${log.pagesRead} pages read</p>
                        </div>
                        <button class="delete-log-btn text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                    ${log.notes ? `<p class="text-gray-600 dark:text-gray-300 mt-2 border-t border-gray-200 dark:border-gray-600 pt-2">${log.notes}</p>` : ''}
                </div>
                `;
            });
            
            elements.readingLogsContainer.innerHTML = logsHTML;
            
            // Render recent logs in the dashboard (only top 5)
            let recentLogsHTML = '';
            sortedLogs.slice(0, 5).forEach(log => {
                const formattedDate = new Date(log.date).toLocaleDateString();
                
                recentLogsHTML += `
                <div class="flex justify-between items-center p-2 border-b border-gray-200 dark:border-gray-600 last:border-0">
                    <div>
                        <h4 class="font-medium text-gray-800 dark:text-gray-100">${log.bookTitle}</h4>
                        <p class="text-gray-500 dark:text-gray-400 text-sm">${formattedDate}</p>
                    </div>
                    <p class="text-purple-600 dark:text-purple-400 font-medium">${log.pagesRead} pages</p>
                </div>
                `;
            });
            
            elements.recentLogsContainer.innerHTML = recentLogsHTML;
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-log-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const logCard = e.target.closest('[data-log-id]');
                    const logId = logCard.dataset.logId;
                    
                    if (confirm('Are you sure you want to delete this reading log?')) {
                        deleteReadingLog(logId);
                        renderReadingLogs();
                        renderCurrentlyReading();
                        updateStats();
                        updateCharts();
                    }
                });
            });
        }
        
        function renderCurrentlyReading() {
            // Get books that are not completed
            const currentBooks = appData.books.filter(book => !book.completed);
            
            if (currentBooks.length === 0) {
                elements.currentReadingList.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4" id="no-books-message">You haven\'t added any books yet.</p>';
                elements.noBooksMessage = document.getElementById('no-books-message');
                return;
            }
            
            if (elements.noBooksMessage) elements.noBooksMessage.classList.add('hidden');
            
            // Sort by progress (highest first)
            currentBooks.sort((a, b) => (b.currentPage / b.totalPages) - (a.currentPage / a.totalPages));
            
            let html = '';
            currentBooks.forEach(book => {
                const progress = Math.round((book.currentPage / book.totalPages) * 100);
                const progressColor = progress < 30 ? 'bg-red-500' : progress < 70 ? 'bg-yellow-500' : 'bg-green-500';
                const remainingPages = book.totalPages - book.currentPage;
                
                html += `
                <div class="flex flex-col sm:flex-row sm:items-center p-3 border-b border-gray-200 dark:border-gray-600 last:border-0">
                    <div class="flex-grow mb-2 sm:mb-0">
                        <h4 class="font-bold text-gray-800 dark:text-gray-100">${book.title}</h4>
                        <p class="text-gray-600 dark:text-gray-300 text-sm">by ${book.author}</p>
                        <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1">
                            <span>${book.currentPage} of ${book.totalPages} pages</span>
                            <span>${remainingPages} pages left</span>
                        </div>
                    </div>
                    <div class="w-full sm:w-32">
                        <div class="flex justify-between text-xs text-gray-600 dark:text-gray-300 mb-1">
                            <span>${progress}%</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                            <div class="${progressColor} h-2 rounded-full" style="width: ${progress}%"></div>
                        </div>
                    </div>
                </div>
                `;
            });
            
            elements.currentReadingList.innerHTML = html;
        }
        
        // Statistics and Insights
        function updateStats() {
            // Calculate totals
            const totalPages = appData.readingLogs.reduce((sum, log) => sum + log.pagesRead, 0);
            const booksCompleted = appData.books.filter(book => book.completed).length;
            const currentBooks = appData.books.filter(book => !book.completed).length;
            
            // Reading streak
            const streak = calculateReadingStreak();
            
            // Average pages per day
            const readingDays = new Set(appData.readingLogs.map(log => log.date)).size;
            const avgPages = readingDays > 0 ? Math.round(totalPages / readingDays) : 0;
            
            // Most pages in a day
            const pagesByDate = {};
            appData.readingLogs.forEach(log => {
                pagesByDate[log.date] = (pagesByDate[log.date] || 0) + log.pagesRead;
            });
            const mostPages = Object.values(pagesByDate).length > 0 ? Math.max(...Object.values(pagesByDate)) : 0;
            
            // Days read this month
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const daysReadThisMonth = appData.readingLogs.filter(log => {
                const logDate = new Date(log.date);
                return logDate.getMonth() === currentMonth && logDate.getFullYear() === currentYear;
            });
            const daysReadThisMonthCount = new Set(daysReadThisMonth.map(log => log.date)).size;
            
            // Update UI
            elements.totalPagesElement.textContent = totalPages;
            elements.booksCompletedElement.textContent = booksCompleted;
            elements.readingStreakElement.textContent = `${streak} days`;
            elements.avgPagesElement.textContent = avgPages;
            elements.mostPagesElement.textContent = mostPages;
            elements.currentBooksElement.textContent = currentBooks;
            elements.daysReadElement.textContent = daysReadThisMonthCount;
        }
        
        function calculateReadingStreak() {
            if (appData.readingLogs.length === 0) {
                return 0;
            }
            
            // Sort logs by date (newest first)
            const sortedDates = [...new Set(appData.readingLogs.map(log => log.date))].sort((a, b) => new Date(b) - new Date(a));
            
            // Check if there's a log for today
            const today = new Date().toISOString().split('T')[0];
            const hasLogToday = sortedDates.includes(today);
            
            // If no log today, start checking from yesterday
            let currentDate = new Date();
            if (!hasLogToday) {
                currentDate.setDate(currentDate.getDate() - 1);
            }
            
            let streak = 0;
            
            // Count consecutive days
            while (true) {
                const dateString = currentDate.toISOString().split('T')[0];
                
                if (sortedDates.includes(dateString)) {
                    streak++;
                } else {
                    break;
                }
                
                // Move to previous day
                currentDate.setDate(currentDate.getDate() - 1);
            }
            
            return streak;
        }
        
        function renderInsights() {
            if (appData.books.length === 0 || appData.readingLogs.length === 0) {
                elements.noProjectionsMessage.classList.remove('hidden');
                return;
            }
            
            elements.noProjectionsMessage.classList.add('hidden');
            
            // Calculate reading rate
            const totalPagesRead = appData.readingLogs.reduce((sum, log) => sum + log.pagesRead, 0);
            const uniqueDaysRead = new Set(appData.readingLogs.map(log => log.date)).size;
            const avgPagesPerDay = uniqueDaysRead > 0 ? totalPagesRead / uniqueDaysRead : 0;
            
            // Create projections for each current book
            const currentBooks = appData.books.filter(book => !book.completed);
            let projectionsHTML = '';
            
            currentBooks.forEach(book => {
                const remainingPages = book.totalPages - book.currentPage;
                const daysToFinish = Math.ceil(remainingPages / avgPagesPerDay);
                
                // Calculate the projected finish date
                const finishDate = new Date();
                finishDate.setDate(finishDate.getDate() + daysToFinish);
                const formattedDate = finishDate.toLocaleDateString(undefined, { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
                
                projectionsHTML += `
                <div class="p-3 border-b border-gray-200 dark:border-gray-600 last:border-0">
                    <h4 class="font-bold text-gray-800 dark:text-gray-100">${book.title}</h4>
                    <p class="text-gray-600 dark:text-gray-300 text-sm">Remaining: ${remainingPages} pages</p>
                    <p class="text-purple-600 dark:text-purple-400 mt-1">Estimated completion: ${formattedDate}</p>
                    <p class="text-gray-500 dark:text-gray-400 text-sm">(about ${daysToFinish} days at your current pace)</p>
                </div>
                `;
            });
            
            elements.readingProjections.innerHTML = projectionsHTML;
        }
        
        // Charts
        function initCharts() {
            // Initialize charts with empty data
            initReadingActivityChart();
            initGenresChart();
            initWeeklyChart();
            initMonthlyChart();
            
            // Update with actual data
            updateCharts();
        }
        
        function initReadingActivityChart() {
            const ctx = elements.readingChart.getContext('2d');
            
            charts.readingActivity = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Pages Read',
                        data: [],
                        borderColor: '#8B5CF6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(200, 200, 200, 0.2)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
        
        function initGenresChart() {
            const ctx = elements.genresChart.getContext('2d');
            
            charts.genres = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#8B5CF6', '#EC4899', '#F97316', '#10B981', '#3B82F6',
                            '#A78BFA', '#FB7185', '#FB923C', '#34D399', '#60A5FA'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }
        
        function initWeeklyChart() {
            const ctx = elements.weeklyChart.getContext('2d');
            
            charts.weekly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Avg. Pages per Day of Week',
                        data: [0, 0, 0, 0, 0, 0, 0],
                        backgroundColor: '#8B5CF6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Reading by Day of Week'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        function initMonthlyChart() {
            const ctx = elements.monthlyChart.getContext('2d');
            
            charts.monthly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'Pages Read by Month',
                        data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        backgroundColor: '#EC4899'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Reading by Month'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        function updateCharts() {
            updateReadingActivityChart();
            updateGenresChart();
            updateWeeklyChart();
            updateMonthlyChart();
        }
        
        function updateReadingActivityChart() {
            if (appData.readingLogs.length === 0) {
                return;
            }
            
            // Group logs by date and sum pages
            const pagesByDate = {};
            appData.readingLogs.forEach(log => {
                pagesByDate[log.date] = (pagesByDate[log.date] || 0) + log.pagesRead;
            });
            
            // Sort dates
            const sortedDates = Object.keys(pagesByDate).sort();
            
            // Limit to last 14 days with data
            const recentDates = sortedDates.slice(-14);
            const recentPages = recentDates.map(date => pagesByDate[date]);
            
            // Format dates for display
            const formattedDates = recentDates.map(date => {
                const d = new Date(date);
                return d.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
            });
            
            // Update chart data
            charts.readingActivity.data.labels = formattedDates;
            charts.readingActivity.data.datasets[0].data = recentPages;
            charts.readingActivity.update();
        }
        
        function updateGenresChart() {
            if (appData.books.length === 0) {
                return;
            }
            
            // Count books by genre
            const genreCounts = {};
            appData.books.forEach(book => {
                genreCounts[book.genre] = (genreCounts[book.genre] || 0) + 1;
            });
            
            // Convert to arrays for chart
            const genres = Object.keys(genreCounts);
            const counts = genres.map(genre => genreCounts[genre]);
            
            // Update chart data
            charts.genres.data.labels = genres;
            charts.genres.data.datasets[0].data = counts;
            charts.genres.update();
        }
        
        function updateWeeklyChart() {
            if (appData.readingLogs.length === 0) {
                return;
            }
            
            // Initialize arrays for each day
            const daysTotals = [0, 0, 0, 0, 0, 0, 0]; // Mon to Sun
            const daysCount = [0, 0, 0, 0, 0, 0, 0];
            
            // Group by day of week
            appData.readingLogs.forEach(log => {
                const date = new Date(log.date);
                const dayOfWeek = date.getDay(); // 0 = Sun, 1 = Mon, ..., 6 = Sat
                const adjustedIndex = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Convert to 0 = Mon, ..., 6 = Sun
                
                daysTotals[adjustedIndex] += log.pagesRead;
                daysCount[adjustedIndex]++;
            });
            
            // Calculate averages
            const daysAvg = daysTotals.map((total, i) => daysCount[i] > 0 ? Math.round(total / daysCount[i]) : 0);
            
            // Update chart data
            charts.weekly.data.datasets[0].data = daysAvg;
            charts.weekly.update();
        }
        
        function updateMonthlyChart() {
            if (appData.readingLogs.length === 0) {
                return;
            }
            
            // Initialize array for each month
            const monthTotals = Array(12).fill(0);
            
            // Group by month
            appData.readingLogs.forEach(log => {
                const date = new Date(log.date);
                const month = date.getMonth(); // 0 = Jan, 1 = Feb, ..., 11 = Dec
                
                monthTotals[month] += log.pagesRead;
            });
            
            // Update chart data
            charts.monthly.data.datasets[0].data = monthTotals;
            charts.monthly.update();
        }
        
        // UI Helpers
        function showNotification(message) {
            elements.notification.querySelector('#notification-text').textContent = message;
            elements.notification.classList.remove('translate-y-20', 'opacity-0');
            elements.notification.classList.add('translate-y-0', 'opacity-100');
            
            setTimeout(() => {
                elements.notification.classList.remove('translate-y-0', 'opacity-100');
                elements.notification.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }
        
        // Event Listeners
        function setupEventListeners() {
            // Tab navigation
            elements.tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.dataset.tab;
                    
                    // Update active tab
                    elements.tabs.forEach(t => t.classList.remove('tab-active'));
                    tab.classList.add('tab-active');
                    
                    // Show target content
                    elements.tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(targetTab).classList.remove('hidden');
                });
            });
            
            // Book form
            elements.addBookBtn.addEventListener('click', () => openBookModal());
            elements.cancelBookBtn.addEventListener('click', () => closeBookModal());
            
            elements.bookForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const bookId = document.getElementById('book-id').value;
                const bookData = {
                    title: document.getElementById('book-title').value,
                    author: document.getElementById('book-author').value,
                    genre: document.getElementById('book-genre').value,
                    totalPages: document.getElementById('book-total-pages').value,
                    currentPage: document.getElementById('book-current-page').value
                };
                
                // Validate current page cannot be more than total pages
                if (parseInt(bookData.currentPage) > parseInt(bookData.totalPages)) {
                    showNotification('Current page cannot be greater than total pages');
                    return;
                }
                
                if (bookId) {
                    // Update existing book
                    updateBook(bookId, bookData);
                    showNotification('Book updated successfully!');
                } else {
                    // Add new book
                    addBook(bookData);
                    showNotification('Book added successfully!');
                }
                
                closeBookModal();
                renderBooks();
                renderCurrentlyReading();
                updateStats();
                renderInsights();
                updateCharts();
            });
            
            // Reading log form
            elements.readingLogForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const logData = {
                    bookId: document.getElementById('log-book').value,
                    date: document.getElementById('log-date').value,
                    pagesRead: document.getElementById('log-pages').value,
                    notes: document.getElementById('log-notes').value
                };
                
                // Validate book selection
                if (!logData.bookId) {
                    showNotification('Please select a book');
                    return;
                }
                
                // Add the reading log
                const result = addReadingLog(logData);
                
                if (result) {
                    // Show success message
                    showNotification(`Added ${logData.pagesRead} pages to your reading log!`);
                    
                    // Reset form
                    document.getElementById('log-pages').value = '';
                    document.getElementById('log-notes').value = '';
                    
                    // Update UI
                    renderReadingLogs();
                    renderCurrentlyReading();
                    updateStats();
                    renderInsights();
                    updateCharts();
                } else {
                    showNotification('Error adding reading log. Please try again.');
                }
            });
            
            // Data import/export
            elements.exportDataBtn.addEventListener('click', () => {
                exportData();
            });
            
            elements.importDataBtn.addEventListener('click', () => {
                importData();
            });
            
            elements.backupBtn.addEventListener('click', () => {
                // Navigate to settings tab and scroll to backup section
                elements.tabs.forEach(tab => {
                    if (tab.dataset.tab === 'settings') {
                        tab.click();
                    }
                });
                exportData();
            });
        }
        
        // Initialize the app
        initApp();
    </script>
</body>
</html>